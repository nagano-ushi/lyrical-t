<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- <meta name="viewport" content="width=device-width,initial-scale=1"> -->
  <title>lyrical-t</title>

  <meta name="theme-color" content="#fffbbd"/>
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="your_title">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="robots" content="noodp ,NOINDEX , NOFOLLOW"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <link rel="stylesheet" href="/lyrical-t/reset.css">  
  <link rel="stylesheet" href="/lyrical-t/style.css">



  <link rel="apple-touch-icon" href="/lyrical-t/icon/16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/20.png" sizes="20x20">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/24.png" sizes="24x24">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/29.png" sizes="29x29">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/32.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/40.png" sizes="40x40">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/48.png" sizes="48x48">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/50.png" sizes="50x50">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/57.png" sizes="57x57">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/64.png" sizes="64x64">	
  <link rel="apple-touch-icon" href="/lyrical-t/icon/72.png" sizes="72x72">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/114.png" sizes="114x114">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/120.png" sizes="120x120">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/128.png" sizes="128x128">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/144.png" sizes="144x144">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/256.png" sizes="256x256">
  <link rel="apple-touch-icon" href="/lyrical-t/icon/512.png" sizes="512x512">
      <!-- Add to splash screen for Safari on iOS -->

  
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/320x568.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/360x640.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/360x800.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/375x667.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/375x812.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/383x812.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/390x844.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/414x736.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/414x986.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/428x926.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/640x960.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/640x1136.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/744x1133.png">
    
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/750x1334.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/768x1024.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/834x1194.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/960x1440.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1024x768.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1024x1366.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1125x2436.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1242x2208.png">
    
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1242x2688.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1536x2048.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1668x2224.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/2048x1536.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/2048x2732.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/2208x1242.png">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/2224x1668.png">
    
    
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" and (orientation: any)"> 
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" and (orientation: any)"> 
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)" and (orientation: any)">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" and (orientation: any)"> 
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1536x2048.png" media="(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2)" and (orientation: any)">
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/1668x2224.png" media="(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2)" and (orientation: any)"> 
      <link rel="apple-touch-startup-image" href="/lyrical-t/screen/2048x2732.png" media="(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) " and (orientation: any)"> 
      
  




  
  <link rel="icon" href="/lyrical-t/icon/favicon.ico"><!-- 512×512 -->
  <!-- <link rel="icon" href="/lyrical-t/icon/lip_gakua_icon.svg" type="image/svg+xml"> -->
  <link rel="apple-touch-icon" href="/lyrical-t/icon/apple-touch-icon.png">



  <link rel="stylesheet" href="/lyrical-t/assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="/lyrical-t/assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="/lyrical-t/assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="/lyrical-t/assets/parallax/jarallax.css">
  <link rel="stylesheet" href="/lyrical-t/assets/dropdown/css/style.css">
  <link rel="stylesheet" href="/lyrical-t/assets/socicon/css/styles.css">
  <link rel="stylesheet" href="/lyrical-t/assets/theme/css/style.css">



  <link rel="preload" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap"></noscript>
  <link rel="preload" as="style" href="/lyrical-t/assets/mo/css/mbr-additional.css"><link rel="stylesheet" href="/lyrical-t/assets/mo/css/mbr-additional.css" type="text/css">
  
  
  <script>
		window.addEventListener('load', (event) => {

			document.getElementById('button1').addEventListener('click', () => {

        // content3の表示位置を取得
				var content3 = document.getElementById('content3');
				var content_position = content3.getBoundingClientRect();

        // content3へ移動
				window.scrollTo( 0, content_position.top);

			});
		});
	</script>
	<style>
		#content1,
		#content2,
		#content3 {
			height: 50px;
			background-color: #ccc;
		}

	</style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1LE9Q8FYTG"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1LE9Q8FYTG');
  </script>






</head>




<body>

  <script>
		window.addEventListener('load', (event) => {

			document.getElementById('button1').addEventListener('click', () => {

        // content3の表示位置を取得
				var content3 = document.getElementById('content3');
				var content_position = content3.getBoundingClientRect();

        // content3へ移動
				window.scrollTo( 0, content_position.top);

			});
		});
	</script>

  <body>

  



  
  <section data-bs-version="5.1" class="header1 cid-s48MCQYojq mbr-fullscreen mbr-parallax-background" id="header1-f">
  
      
  
      <div class="mbr-overlay" style="opacity: 0.2; background-color: rgb(255, 255, 255);"></div>
  
      <div class="align-center container">
          <div class="row justify-content-center">
              <div class="col-12 col-lg-8">
                  <h1 class="mbr-section-title mbr-fonts-style mb-3 display-1"><strong>サマーリリカル<br>着色程度の判定</strong></h1>
                  
                  <p class="mbr-text mbr-fonts-style display-7">高温期は取り遅れに注意してください。<br>画面に映らない裏側は分類できません。</p>
                  <div class="mbr-section-btn mt-3">
                    <!--<a class="btn btn-success display-4" href="/lyrical-t/assets/files/samplepdf.pdf" target="_blank">samplepdf</a> 
                    <a class="btn btn-secondary display-4" href="/lyrical-t/assets/files/samplepdf2.pdf" target="_blank">samplepdf2</a></div> -->
                    <h6><button id="button1">判定へ移動</button></h6>
              </div>
          </div>
      </div>
  </section>










  <section data-bs-version="5.1" class="gallery3 cid-tgls86edeq" id="gallery3-z">
      
      
      <div class="container-fluid">
          <div class="mbr-section-head">
              <h1 class="mbr-section-title mbr-fonts-style align-center mb-0 display-2"><strong>サマーリリカルの着色程度を判定します</strong></h1>
              <h5 class="mbr-section-subtitle mbr-fonts-style align-center mb-0 mt-2 display-7">塩尻市で5月下旬から10月下旬までに<br>撮影した画像をもとに作成</h5>
          </div>
          <div class="row mt-4">
              <div class="item features-image сol-12 col-md-6 col-lg-3">
                  <div class="item-wrapper">
                      <div class="item-img">
                          <img src="/lyrical-t/assets/images/lyrical3kara4bu.png" alt="">
                      </div>
                      <div class="item-content">
                          <h5 class="item-title mbr-fonts-style display-7"><strong>着色程度<br>３～４分</strong></h5>
                          
                          <p class="mbr-text mbr-fonts-style mt-3 display-7">（高温期）果実先端から徐々に色がついていきます</p>
                      </div>
                      
                  </div>
              </div>
              <div class="item features-image сol-12 col-md-6 col-lg-3">
                  <div class="item-wrapper">
                      <div class="item-img">
                          <img src="/lyrical-t/assets/images/lyrical5kara6bu.png" alt="">
                      </div>
                      <div class="item-content">
                          <h5 class="item-title mbr-fonts-style display-7"><strong>着色程度<br>５～６分</strong></h5>
                          
                          <p class="mbr-text mbr-fonts-style mt-3 display-7">（高温期）果実赤道面付近まで着色が進みます</p>
                      </div>
                      
                  </div>
              </div>
              <div class="item features-image сol-12 col-md-6 col-lg-3">
                  <div class="item-wrapper">
                      <div class="item-img">
                          <img src="/lyrical-t/assets/images/lyrical7kara8bu.png" alt="">
                      </div>
                      <div class="item-content">
                          <h5 class="item-title mbr-fonts-style display-7"><strong>着色程度<br>７～８分</strong></h5>
                          
                          <p class="mbr-text mbr-fonts-style mt-3 display-7">（高温期）果実肩部付近まで着色が進みます</p>
                      </div>
                      
                  </div>
              </div>
              <div class="item features-image сol-12 col-md-6 col-lg-3">
                  <div class="item-wrapper">
                      <div class="item-img">
                          <img src="/lyrical-t/assets/images/lyrical9buijyou.png" alt="" title="">
                      </div>
                      <div class="item-content">
                          <h5 class="item-title mbr-fonts-style display-7"><strong>着色程度<br>９分以上</strong></h5>
                          
                          <p class="mbr-text mbr-fonts-style mt-3 display-7">当アプリの画像分類の対象外です</p>
                      </div>
              </div>

                      
            
          
          </div>
      </div>
  </section>



  
  <script>
    // manifestのlinkタグを生成
    function setManifest(path) {
      const manifest = document.createElement('link');
      manifest.rel = 'manifest';
      manifest.href = path;
      document.head.appendChild(manifest);
    }

    // OSに応じて読み込むmanifestを変更
    var userAgent = navigator.userAgent.toLowerCase();
    if (userAgent.indexOf("iphone") > 0 || userAgent.indexOf("ipad") > 0) {
      setManifest('/lyrical-t/manifest_ios.json')
    } else {
      setManifest('/lyrical-t/manifest.json')
    }
    </script>  

  




  <video id="video" autoplay muted playsinline width="30px" height="30px"></video>
  <h8>ヘタを上に</h8>
  <canvas id="canvas" height="300px" width="300px"></canvas>
  <h8>画面の中央に<br>果実を<br>大きく映してください</h8>
  <h4>
    <button type="button" onclick="init()">画像の判定を開始（ここをタップ！）</button></h4>
  
  <h7>着色程度３～４分と５～６分、７～８分のいずれかに判定します。</h7>
  <h7>判定の結果は（↓ここに表示）</h7>

  <h2><div id="label-container">-</div></h2>
  
  

  <!-- <h4>
    <button id="download">画像をダウンロード</button></h4> -->
  
  <h3><div id="content3"></div></h3>

  

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <script>

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('serviceWorker.js').then(reg => {
      console.log('サービスワーカーを登録しました', reg);
      }).catch(err => {
      console.log('登録失敗', err);
      });
    }
  </script>

</body>
</html>


<script type="text/javascript">

  let medias;
  //カメラの設定をmediasに格納、※environmentでリアカメラを設定 user
    medias = {
    audio: false,
    video: {
      facingMode: { exact: "environment" }  
    }}
    //};
  
    //DOMに要素追加
      //カメラ映像を出すvideoタグを取得する
      const video = document.getElementById("video");
      //設定したカメラのセッティングで起動する変数promiseを設定
      const promise = navigator.mediaDevices.getUserMedia(medias);
  
      //カメラの起動許可を確認
      promise.then(successCallback)
          .catch(errorCallback);
      //許可が取れるとコールバックしてvideoタグにカメラ映像を写す
      function successCallback(stream) {
      video.srcObject = stream;
      };
      //取れない場合はエラーメッセージを出す
      function errorCallback(err) {
      alert(err);
      };
  
  //googleのteachablemachineを使用して画像解析をする
  const URL = "./my_model/";
  
  let model, labelContainer, maxPredictions;
  
  // initボタンを押すと画像解析をスタートする、コードの中でawaitを使うためasync functionが必要
  async function init() {
  
    //モデルURLを読み込む
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";
  
    //モデルのイメージを入れる
    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();
  
    //結果を出す為のlavelcontainerをDOMに要素追加する
    labelContainer = document.getElementById("label-container");
    labelContainer2 = document.getElementById("label-container2");
  
    window.requestAnimationFrame(loop);
  }
  
    async function loop() {
      //canvasに静止画を入れる
      var canvas =document.getElementById("canvas")
      canvas.getContext("2d").drawImage(video, 0, 0, 300, 300)

      
  
      /*document.getElementById("download").onclick = (event) => {
        let canvas = document.getElementById("canvas");
  
        let link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "test.png";
        link.click();}*/
  
  
      //予測は、画像、ビデオ、またはキャンバスのhtml要素を取り込むことができます
      const prediction = await model.predict(canvas);
  
      if ( prediction[0].probability.toFixed(2)>0) {
        labelContainer.innerHTML = "不明";
          }
  
      if ( prediction[0].probability.toFixed(2)> 0.8) {
        labelContainer.innerHTML = "着色程度　３～４分　です。";
          }
  
      if ( prediction[1].probability.toFixed(2)>0) {
        labelContainer.innerHTML = "不明";
          }    
    
      if ( prediction[1].probability.toFixed(2)> 0.5) {
        labelContainer.innerHTML = "着色程度　５～６分　です。";
          }
  
      if ( prediction[2].probability.toFixed(2)>0) {
        labelContainer.innerHTML = "不明";
          }
  
      if ( prediction[2].probability.toFixed(2)> 0.8) {
        labelContainer.innerHTML = "着色程度　７～８分　です。";
          }
      
      //処理を継続させるためloopをさせる
      window.requestAnimationFrame(loop);
        }
    
  </script>
